func (t {{ .Name }}) Marshal(encoder *protocol.Encoder) {
{{- range $i, $f := .Fields | forVersion .Version }}
{{- if .Type | isPrimitiveArray }}
  encoder.Put{{ .Type | baseType | capitalize }}Array(t.{{ $f.Name }})
{{- end }}
{{- if .Type | isStructArray }}
  encoder.PutArray(len(t.{{ $f.Name }}), func(i int) { t.{{ $f.Name }}[i].Marshal(encoder) })
{{- end }}
{{- if .Type | isArray | not }}
  encoder.Put{{ .Type | capitalize }}(t.{{ $f.Name}})
{{- end }}
{{- end }}
}
